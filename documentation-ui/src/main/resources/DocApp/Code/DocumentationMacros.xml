<?xml version="1.1" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.6" reference="DocApp.Code.DocumentationMacros" locale="">
  <web>DocApp.Code</web>
  <name>DocumentationMacros</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <parent>WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title>Documentation Macros</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity output="false"}}
#macro(getTarget $return)
  ## Decide what is the target audience by checking the DocumentationClass xobject of the current page.
  #set ($target = $doc.getObject('DocApp.Code.DocumentationClass').getValue('target'))
  ## If not found, try to deduce the product by recognizing the URL.
  #if ("$!target" == '')
    ## Look for /User/, /Admin/ or /Dev/ in the URL. We need this to address Landing Pages which don't have an DocumentationClass xobject.
    #set ($docURL = $doc.getURL())
    #if ($stringtool.containsIgnoreCase($docURL, '/user/'))
      #set ($target = 'user')
    #elseif ($stringtool.containsIgnoreCase($docURL, '/admin/'))
      #set ($target = 'administrator')
    #elseif ($stringtool.containsIgnoreCase($docURL, '/dev/'))
      #set ($target = 'developer')
    #else
      #set ($target = 'user')
    #end
  #end
  #set ($return = $NULL)
  #setVariable("$return" $target)
#end

#macro(getProduct $return)
  ## Extract the product from the doc reference
  #set ($spaceList = $doc.getDocumentReference().getSpaceReferences())
  ## Default product is XS
  #set ($product = 'xs')
  #if ($spaceList.size() &gt; 1)
    #set ($extractedProduct = $spaceList.get(1).name)
    #set ($product = $extractedProduct)
  #end
  #set ($return = $NULL)
  #setVariable("$return" $product)
#end

#macro(getTargetSpaceReference $return)
  ## Extract the target from the doc reference which should be of the type: XXX.&lt;product&gt;.&lt;target&gt;
  #set ($spaceList = $doc.getDocumentReference().getSpaceReferences())
  #if ($spaceList.size() &gt; 2)
    #set ($targetReference = $spaceList.get(2))
  #else
    #set ($targetReference = $NULL)
  #end
  #set ($return = $NULL)
  #setVariable("$return" $targetReference)
#end

#macro(getProductName $product $return)
  #set ($productNames = {'xs' : 'XWiki Standard'})
  #set ($productName = $product)
  #if ("$!productNames[$product.toLowerCase()]" != '')
    #set ($productName = $productNames[$product])
  #end
  #set ($return = $NULL)
  #setVariable("$return" $productName)
#end
{{/velocity}}
</content>
</xwikidoc>
